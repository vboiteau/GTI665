input = './Medias/wav/man.wav';
%input = './Medias/wav/woman.wav';
info = audioinfo(input);
signal = audioread(input);
chunks = splitSignal(signal);
window = hamming(180);
%disp("Chunks: "+length(chunks));

fileID = fopen('man.LPC','w');
fprintf(fileID,'c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,gain,isVoiced,pitch\n');

doit = 1;
for i = 1:length(chunks)
    chunk = chunks(i,:);
    isSilence = detectSilence(chunk);
    if isSilence == 0
        isVoiced = detectVoiced(chunk);
        
        if isVoiced
            [f0_time,f0_value,SHR,f0_candidates] = shrp(chunk,8000,[50 250],22.5,22.5,0.4,1250,0,0);
        end
        
        weightedChunk = chunk.*transpose(window);
            
        filteredChunk = conv(weightedChunk,1-0.9375);

        [AR,E,K] = lpcauto(filteredChunk,10,180);
        gain = sqrt(E);
        coefficients = AR(2:length(AR));
        
        fprintf(fileID,'c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,gain,isVoiced,pitch\n');
        

%         if doit 
%             wvtool(chunk)
%             wvtool(window);
%             wvtool(weightedChunk);
%             wvtool(filteredChunk);
%         end
        doit = 0;
    else
        fprintf(fileID,'0,0,0,0,0,0,0,0,0,0,0,0,0\n');
    end
    
end